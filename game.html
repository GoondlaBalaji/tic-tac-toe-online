<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Tic-Tac-Toe: KA-POW! Offline</title>

    <!-- FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Permanent+Marker&family=Kalam:wght@400;700&display=swap" rel="stylesheet">

    <style>
/* ===========================================================
   COMIC STYLE VARIABLES
   =========================================================== */
:root {
    --font-bangers: 'Bangers', cursive;
    --font-marker: 'Permanent Marker', cursive;
    --font-hand: 'Kalam', cursive;

    --ink: #111;
    --paper: #f7f7f2;

    --x-color: #ff4500;
    --o-color: #1e90ff;

    --win-line: #32cd32;
}

/* ===========================================================
   GLOBAL RESET + FULLSCREEN FIX
   =========================================================== */
* { box-sizing: border-box; margin: 0; padding: 0; }

html, body {
    width: 100%;
    height: 100%;
    overflow: hidden;        /* ðŸ”¥ No scrollbars */
    background: var(--paper);
}

/* ===========================================================
   COMIC DOT BACKGROUND
   =========================================================== */
body {
    display: flex;
    align-items: center;
    justify-content: center;

    background-image:
        radial-gradient(var(--ink) 0.6px, transparent 0.6px),
        radial-gradient(var(--ink) 0.6px, var(--paper) 0.6px);
    background-size: 14px 14px;
    background-position: 0 0, 7px 7px;
}

/* ===========================================================
   MAIN GAME PANEL â€” PERFECT FOR MOBILE
   =========================================================== */
#game-container {
    width: 90vw;
    max-width: 360px;              /* ðŸ”¥ Smaller for phone */
    background: var(--paper);
    border: 6px solid var(--ink);
    box-shadow: 10px 10px 0 var(--ink);
    padding: 18px;
    transform: skewX(-3deg);
}

#game-container > * {
    transform: skewX(3deg);        /* Fix skew for children */
}

/* ===========================================================
   TITLE
   =========================================================== */
#title {
    font-family: var(--font-bangers);
    font-size: 2.7em;
    text-align: center;
    color: var(--x-color);
    text-shadow: 4px 4px 0 var(--ink);
    margin-bottom: 10px;
}

/* ===========================================================
   STATUS BAR
   =========================================================== */
#status {
    font-family: var(--font-marker);
    font-size: 1.4em;
    text-align: center;
    margin-bottom: 14px;
    padding: 8px;
    border: 2px dashed var(--ink);
    background: #ffffffbb;
}

/* ===========================================================
   BOARD (3Ã—3)
   =========================================================== */
#board {
    width: 100%;
    aspect-ratio: 1 / 1;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
    background: var(--ink);
}

.cell {
    background: var(--paper);
    border: 2px solid var(--ink);
    display: flex;
    align-items: center;
    justify-content: center;

    font-family: var(--font-marker);
    font-size: 3.2em;
    user-select: none;
    cursor: pointer;
}

/* X & O styles */
.cell.x-played .piece {
    color: var(--x-color);
    text-shadow: 3px 3px 0 var(--ink);
}

.cell.o-played .piece {
    color: var(--o-color);
    text-shadow: 3px 3px 0 var(--ink);
}

/* ===========================================================
   WINNING CELL HIGHLIGHT
   =========================================================== */
.cell.winning {
    background: var(--win-line) !important;
    border-color: var(--ink) !important;
}

/* ===========================================================
   RESET BUTTON
   =========================================================== */
#reset-button {
    margin-top: 16px;
    width: 100%;
    padding: 10px;

    font-family: var(--font-bangers);
    font-size: 1.4em;
    background: var(--win-line);
    border: 4px solid var(--ink);
    color: var(--paper);
    box-shadow: 4px 4px 0 var(--ink);
}
#reset-button:active {
    transform: translate(2px, 2px);
    box-shadow: 2px 2px 0 var(--ink);
}

/* ===========================================================
   GAME OVER OVERLAY (WIN/LOSE/DRAW)
   =========================================================== */
#game-over-overlay {
    position: fixed;
    inset: 0;
    background: #000000dd;
    display: none;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    z-index: 9999;
}

.game-over-message {
    font-family: var(--font-bangers);
    font-size: 3.5em;
    color: var(--paper);
    text-shadow: 5px 5px 0 var(--ink);
    margin-bottom: 20px;
}

/* ===========================================================
   GIF SHOWCASE FULLSCREEN (Same as online.html)
   =========================================================== */
#gif-showcase-overlay {
    position: fixed;
    inset: 0;
    display: none;
    background: black;
    align-items: center;
    justify-content: center;
    z-index: 999999;
}

#gif-showcase-image {
    height: 100vh;              /* ðŸ”¥ Touch top & bottom */
    width: auto;
    object-fit: contain;
    transform: scale(0.88);     /* ðŸ”¥ Same perfect size as online.html */
}

#gif-showcase-image.rotate-mobile {
    height: 100vw;
    width: auto;
    transform: translate(-0%, -0%) rotate(90deg) scale(0.88);
}

/* Fix overscroll pull-to-refresh */
html {
    overscroll-behavior-y: none;
}
    </style>
</head>

<body>
<div id="game-container">

    <h1 id="title">TIC-TAC-TOE!</h1>

    <div id="status">Player X's Turn!</div>

    <!-- GAME BOARD -->
    <div id="board">
        <div class="cell" data-index="0"></div>
        <div class="cell" data-index="1"></div>
        <div class="cell" data-index="2"></div>
        <div class="cell" data-index="3"></div>
        <div class="cell" data-index="4"></div>
        <div class="cell" data-index="5"></div>
        <div class="cell" data-index="6"></div>
        <div class="cell" data-index="7"></div>
        <div class="cell" data-index="8"></div>
    </div>

    <!-- RESET BUTTON -->
    <button id="reset-button">NEW ARC!</button>

    <!-- GAME OVER OVERLAY -->
    <div id="game-over-overlay">
        <div class="game-over-message" id="overlay-message"></div>

        <div id="gif-button-container"></div>
    </div>

</div>

<!-- SOUND EFFECT FLOATING TEXT -->
<div id="sound-effect-display"></div>

<!-- FULLSCREEN GIF SHOWCASE -->
<div id="gif-showcase-overlay">
    <img id="gif-showcase-image" src="" alt="Scene GIF">
</div>
<script>
document.addEventListener("DOMContentLoaded", () => {

    const board = document.getElementById("board");
    const cells = document.querySelectorAll(".cell");
    const statusDisplay = document.getElementById("status");
    const resetButton = document.getElementById("reset-button");

    const overlay = document.getElementById("game-over-overlay");
    const overlayMessage = document.getElementById("overlay-message");
    const gifButtonContainer = document.getElementById("gif-button-container");

    const gifOverlay = document.getElementById("gif-showcase-overlay");
    const gifImage = document.getElementById("gif-showcase-image");

    const soundText = document.getElementById("sound-effect-display");

    /* ===========================================================
       GAME STATE
    ============================================================ */
    let gameActive = true;
    let currentPlayer = "X";
    let gameState = ["", "", "", "", "", "", "", "", ""];

    const wins = [
        [0,1,2], [3,4,5], [6,7,8],  // rows
        [0,3,6], [1,4,7], [2,5,8],  // columns
        [0,4,8], [2,4,6]            // diagonals
    ];

    /* ===========================================================
       FIGHT SCENE GIFS (same as online)
    ============================================================ */
    const fightScenes = [
        { name: "CRITICAL HOOK", file: "animation/ani3.gif" },
        { name: "WHIP ATTACK", file: "animation/ani2.gif" },
        { name: "DUELING STRINGS", file: "animation/ani5.gif" },
        { name: "SAMURAI CHARGE", file: "animation/ani7.gif" },
        { name: "AXE PARRY", file: "animation/ani6.gif" },
        { name: "RISING UPPERCUT", file: "animation/ani1.gif" },
        { name: "SPEED PUNCH", file: "animation/ani4.gif" },
    ];

    /* ===========================================================
       SOUND EFFECTS (simple)
    ============================================================ */
    function showSoundEffect(text, color) {
        soundText.textContent = text;
        soundText.style.color = color;
        soundText.style.textShadow = `5px 5px 0 var(--ink)`;
        soundText.classList.add("show");

        setTimeout(() => soundText.classList.remove("show"), 600);
    }

    /* ===========================================================
       GAME INITIALIZE
    ============================================================ */
    function initializeGame() {
        gameActive = true;
        currentPlayer = "X";
        gameState = ["", "", "", "", "", "", "", "", ""];

        statusDisplay.textContent = "Player X's Turn!";
        statusDisplay.style.color = "var(--ink)";

        cells.forEach(cell => {
            cell.textContent = "";
            cell.className = "cell";
        });

        overlay.style.display = "none";
        gifButtonContainer.innerHTML = "";
    }

    /* ===========================================================
       CELL CLICK
    ============================================================ */
    function handleCellClick(e) {
        const cell = e.target;
        const index = parseInt(cell.getAttribute("data-index"));

        if (gameState[index] !== "" || !gameActive) return;

        gameState[index] = currentPlayer;
        cell.innerHTML = `<span class="piece">${currentPlayer}</span>`;
        cell.classList.add(currentPlayer === "X" ? "x-played" : "o-played");

        showSoundEffect(
            currentPlayer === "X" ? "KA-CHINK!" : "WHUMP!",
            currentPlayer === "X" ? "var(--x-color)" : "var(--o-color)"
        );

        checkResult();
    }

    /* ===========================================================
       WIN / DRAW CHECK
    ============================================================ */
    function checkResult() {

        let roundWon = false;
        let winningCombo = [];

        for (let combo of wins) {
            const [a, b, c] = combo;
            if (gameState[a] && gameState[a] === gameState[b] && gameState[b] === gameState[c]) {
                roundWon = true;
                winningCombo = combo;
                break;
            }
        }

        if (roundWon) {
            gameActive = false;

            winningCombo.forEach(i => cells[i].classList.add("winning"));

            statusDisplay.textContent = `Player ${currentPlayer} Wins!`;
            statusDisplay.style.color = "var(--win-line)";

            setTimeout(() => {
                overlayMessage.textContent = `${currentPlayer} WINS!`;
                overlay.style.display = "flex";
                buildGifButtons("win");
            }, 400);

            return;
        }

        if (!gameState.includes("")) {
            gameActive = false;
            statusDisplay.textContent = "DRAW!";
            statusDisplay.style.color = "var(--ink)";

            setTimeout(() => {
                overlayMessage.textContent = "DRAW!";
                overlay.style.display = "flex";
                buildGifButtons("draw");
            }, 400);

            return;
        }

        currentPlayer = currentPlayer === "X" ? "O" : "X";
        statusDisplay.textContent = `Player ${currentPlayer}'s Turn!`;
        statusDisplay.style.color =
            currentPlayer === "X" ? "var(--x-color)" : "var(--o-color)";
    }

    /* ===========================================================
       BUILD GIF BUTTON
    ============================================================ */
    function buildGifButtons(outcome) {
        gifButtonContainer.innerHTML = "";

        const scene = fightScenes[Math.floor(Math.random() * fightScenes.length)];

        // BONUS SCENE BUTTON
        const gifBtn = document.createElement("button");
        gifBtn.className = "comic-button";
        gifBtn.textContent = `BONUS SCENE: ${scene.name}!`;
        gifBtn.onclick = () => showGif(scene.file);

        gifButtonContainer.appendChild(gifBtn);

        // NEW ARC BUTTON
        const arcBtn = document.createElement("button");
        arcBtn.className = "comic-button";
        arcBtn.textContent = "START NEW ARC";
        arcBtn.onclick = initializeGame;

        gifButtonContainer.appendChild(arcBtn);
    }

    /* ===========================================================
       SHOW GIF FULLSCREEN
    ============================================================ */
    function showGif(file) {
        gifImage.src = file;
        gifOverlay.style.display = "flex";

        const isPortrait = window.innerHeight > window.innerWidth;
        if (isPortrait) {
            gifImage.classList.add("rotate-mobile");
        } else {
            gifImage.classList.remove("rotate-mobile");
        }
    }

    gifOverlay.onclick = () => {
        gifOverlay.style.display = "none";
        gifImage.src = "";
        gifImage.classList.remove("rotate-mobile");
    };

    /* ===========================================================
       EVENT LISTENERS
    ============================================================ */
    cells.forEach(cell => cell.addEventListener("click", handleCellClick));
    resetButton.addEventListener("click", initializeGame);

    /* START GAME */
    initializeGame();
});
</script>

</body>
</html>
